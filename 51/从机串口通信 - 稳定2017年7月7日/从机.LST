C51 COMPILER V9.00   从_                                                                  07/07/2017 19:39:36 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE 从_
OBJECT MODULE PLACED IN 从机.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 从机.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h> //包含头文件，一般情况不需要改动，头文件包含特殊功能寄存器的定义   
   2          #define uchar unsigned char//宏定义无符号字符型
   3          #define uint unsigned int  //宏定义无符号整型
   4          /********************************************************************
   5                                      初始定义
   6          *********************************************************************/
   7          
   8          unsigned char dat; //用于存储单片机接收发送缓冲寄存器SBUF里面的内容
   9          int i;
  10          
  11          
  12          /*定义八位出为单片机P2口*/
  13          sbit K1=P2^0;
  14          sbit K2=P2^1;
  15          sbit K3=P2^2;
  16          sbit K4=P2^3;
  17          sbit K5=P2^4;
  18          sbit K6=P2^5;
  19          sbit K7=P2^6;
  20          sbit K8=P2^7;
  21          
  22          /*定义八位入为单片机P1口*/
  23          sbit SB1=P1^0;
  24          sbit SB2=P1^1;
  25          sbit SB3=P1^2;
  26          sbit SB4=P1^3;
  27          sbit SB5=P1^4;
  28          sbit SB6=P1^5;
  29          sbit SB7=P1^6;
  30          sbit SB8=P1^7;
  31          
  32          void delay(int t)
  33          {
  34   1         while(t--);
  35   1         while(t--);
  36   1      }
  37          
  38                               
  39          
  40          /*------------------------------------------------
  41                             函数声明
  42          ------------------------------------------------*/
  43          void SendStr(unsigned char *s);
  44          void SendByte(unsigned char da);
  45          
  46          /*------------------------------------------------
  47                              串口初始化
  48          ------------------------------------------------*/
  49          void InitUART  (void)
  50          {
  51   1              PCON = 0x00;
  52   1          SCON  = 0x50;                       // SCON: 模式 1, 8-bit UART, 使能接收  
  53   1          TMOD |= 0x20;               // TMOD: timer 1, mode 2, 8-bit 重装
  54   1          TH1   = 0xFD;               // TH1:  重装值 9600 波特率 晶振 11.0592MHz 
  55   1              TL1 = 0xFd; 
C51 COMPILER V9.00   从_                                                                  07/07/2017 19:39:36 PAGE 2   

  56   1          TR1   = 1;                  // TR1:  timer 1 打开                         
  57   1          EA    = 1;                  //打开总中断
  58   1          ES    = 1;                  //打开串口中断
  59   1      }   
  60          
  61          
  62                                
  63          /*------------------------------------------------
  64                              主函数
  65          ------------------------------------------------*/
  66          //int m;
  67          //int flag=0;
  68          //unsigned char ss;
  69          int judge[8];
  70          unsigned char ZTS[8]={0xff,0xfe,0x00,0x00,0x00,0x00,0xfd,0xfd};
  71          int cnt=0;
  72          uchar ZTT,ZTW;
  73          uchar ZT;
  74          void main (void)
  75          {
  76   1              
  77   1         //res=0;
  78   1         InitUART();
  79   1              ZTT=0xff;
  80   1              ZTW=0xdd;
  81   1         ES= 1;//打开串口中断
  82   1         
  83   1        while (1)                       
  84   1          {   
  85   2              
  86   2                      ZT=P1;
  87   2                      SendByte(ZTT);
  88   2                      SendByte(ZT);
  89   2                      SendByte(ZTW);
  90   2                      //SendStr(ZTS);
  91   2                      delay(1000);
  92   2              
  93   2            
  94   2             if(judge[0]==0xFF&&judge[1]==0xFE&&judge[6]==0xFD&&judge[7]==0xFC)
  95   2                 { 
  96   3      
  97   3                  dat=judge[2];
  98   3                      switch(dat)
  99   3                      {
 100   4      
 101   4      
 102   4      uchar k;
 103   4      k=10;
 104   4      case 0xff: P2=0X00;delay(k);dat=0xee;break; //  全开
 105   4      case 0x00: P2=0XFF;delay(k);dat=0xee;break; //  全关
 106   4      
 107   4      case 0x01: K1=0;delay(k);dat=0xee;break;           //  第一路开
 108   4      case 0x02: K2=0;delay(k);dat=0xee;break;           //  第二路开
 109   4      case 0x03: K3=0;delay(k);dat=0xee;break;           //  第三路开
 110   4      case 0x04: K4=0;delay(k);dat=0xee;break;           //  第四路开
 111   4      case 0x05: K5=0;delay(k);dat=0xee;break;           //  第五路开
 112   4      case 0x06: K6=0;delay(k);dat=0xee;break;           //  第六路开
 113   4      case 0x07: K7=0;delay(k);dat=0xee;break;           //  第七路开
 114   4      case 0x08: K8=0;delay(k);dat=0xee;break;           //  第八路开
 115   4      
 116   4      case 0xFE: K1=1;delay(k);dat=0xee;break;           //  第一路关
 117   4      case 0xFD: K2=1;delay(k);dat=0xee;break;           //  第二路关
C51 COMPILER V9.00   从_                                                                  07/07/2017 19:39:36 PAGE 3   

 118   4      case 0xFC: K3=1;delay(k);dat=0xee;break;           //  第三路关
 119   4      case 0xFB: K4=1;delay(k);dat=0xee;break;           //  第四路关
 120   4      case 0xFA: K5=1;delay(k);dat=0xee;break;           //  第五路关
 121   4      case 0xF9: K6=1;delay(k);dat=0xee;break;           //  第六路关
 122   4      case 0xF8: K7=1;delay(k);dat=0xee;break;           //  第七路关
 123   4      case 0xF7: K8=1;delay(k);dat=0xee;break;           //  第八路关
 124   4      
 125   4      case 0x55: ZTS[2]=P1;delay(k);SendStr(ZTS);dat=0xee;break;         //  读输入口状态
 126   4      case 0xAA: ZTS[2]=P2;delay(k);SendStr(ZTS);dat=0xee;break;         //  读输出口状态
 127   4      
 128   4      case 0x11: P2=~P2;delay(k);dat=0xee;break;  //  输出口取反
 129   4      
 130   4      default:break;                                     //  跳出
 131   4                      }
 132   3                }
 133   2      
 134   2          }
 135   1      }
 136          
 137          
 138          
 139          /*------------------------------------------------
 140                              发送一个字节
 141          ------------------------------------------------*/
 142          void SendByte(unsigned char da)
 143                  {
 144   1              SBUF = da;
 145   1              while(!TI);
 146   1              TI = 0;
 147   1              }
 148          /*------------------------------------------------
 149                              发送一个字符串
 150          ------------------------------------------------*/
 151            void SendStr(unsigned char *s)
 152          {
 153   1       while(*s!='\0')// \0 表示字符串结束标志，通过检测是否字符串末尾
 154   1        {
 155   2        SendByte(*s);
 156   2        delay(50);
 157   2        s++;
 158   2        }
 159   1      }
 160          
 161          
 162          
 163          
 164          /*------------------------------------------------
 165                               串口中断程序
 166          ------------------------------------------------*/
 167          void UART_SER (void) interrupt 4 //串行中断服务程序
 168          {
 169   1          unsigned char Temp;          //定义临时变量 
 170   1         
 171   1         if(RI)                        //判断是接收中断产生
 172   1           {
 173   2                RI=0;                      //标志位清零
 174   2                Temp=SBUF;                 //读入缓冲区的值
 175   2                                   
 176   2                judge[cnt++]=Temp; 
 177   2      
 178   2            //报头不满足或者一个协议帧发送完毕
 179   2            if(cnt==8||judge[0]!=0xFF)          
C51 COMPILER V9.00   从_                                                                  07/07/2017 19:39:36 PAGE 4   

 180   2            cnt=0;
 181   2            //SBUF=Temp;     
 182   2                //TI=1;
 183   2               }
 184   1         
 185   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    484    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
